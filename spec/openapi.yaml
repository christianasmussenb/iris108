openapi: 3.1.0
info:
  title: IRIS Data Agent API
  version: 1.0.0
servers:
  - url: https://<TU-DOMINIO>/api/gpt/v1

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

security:
  - ApiKeyAuth: []

paths:
  /capabilities:
    get:
      operationId: getCapabilities
      responses:
        "200": { description: OK }

  /kpi/explain:
    post:
      operationId: explainKpi
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [kpi_id]
              properties:
                kpi_id: { type: string }
      responses:
        "200": { description: OK }

  /kpi/query:
    post:
      operationId: queryKpi
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [kpi_id, time]
              properties:
                kpi_id: { type: string }
                time:
                  type: object
                  required: [from, to, grain]
                  properties:
                    from: { type: string }
                    to: { type: string }
                    grain: { type: string, enum: [day, week, month] }
                group_by:
                  type: array
                  items: { type: string }
                filters:
                  type: array
                  items:
                    type: object
                    required: [field, op, value]
                    properties:
                      field: { type: string }
                      op: { type: string }
                      value: {}
                options:
                  type: object
                  properties:
                    limit: { type: integer }
      responses:
        "200": { description: OK }

  /cube/query:
    post:
      operationId: queryCubeTemplate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [template_id, params]
              properties:
                template_id: { type: string }
                params: { type: object }
      responses:
        "200": { description: OK }

  /dq/status:
    post:
      operationId: dataQualityStatus
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [subject, time]
              properties:
                subject: { type: string }
                time:
                  type: object
                  required: [from, to]
                  properties:
                    from: { type: string }
                    to: { type: string }
      responses:
        "200": { description: OK }
